# 使用者偏好設定 (User Preferences)

1.  **語言 (Language)**：請在 **所有** 回應與產出文件（包含實作計畫、目標等）中使用 **繁體中文 (Traditional Chinese)**。

2.  **行動前先計畫 (Plan Before Action)**：請勿直接執行任何程式碼修改。務必先提供實作計畫。計畫必須分為明確的階段/步驟。請等待我的確認後再繼續。

3.  **錯誤處理與權限 (Error Handling & Permissions)**：當生成程式碼或回答問題時，若遇到無法處理的問題或錯誤；或在修改程式碼時，發現缺乏權限繼續修復缺陷或錯誤，請 **停止 (STOP)**。不要繼續生成。請指出遇到的困難，並提供解決方案讓我自行處理。

# 核心開發準則 (Core Development Guidelines)

4.  **程式碼品質 (Code Quality)**:
    *   **遵循命名規範**：依據語言特性使用 camelCase、PascalCase 或 snake_case。
    *   **函式單一職責 (SRP)**：確保每個函式只做一件事。
    *   **避免過度複雜**：降低 Cyclomatic Complexity。
    *   **避免 magic numbers**：使用常數或 enum 取代裸露的數字。
    *   **完整註解**：解釋「為什麼」(Why) 這樣寫，而不是「做什麼」(What)。
    *   **遵循 Lint 規範**：使用 ESLint, Pylint, RuboCop 等工具。
    *   **使用 Formatter**：使用 Prettier, Black, gofmt 等工具維持格式一致。

5.  **安全性指南 (Security Guidelines)**:
    *   **機敏資料保護**：絕不在程式碼中硬編碼 (Hardcode) 密碼、Token 或 API Key。
    *   **資料加密**：儲存敏感資料需使用強加密演算法（如 AES、RSA）。
    *   **密碼雜湊**：密碼必須雜湊後儲存（使用 bcrypt、argon2 等）。
    *   **防範注入攻擊**：SQL 查詢務必使用 Prepared Statement 以防範 SQL Injection。
    *   **身份驗證**：API 必須實作身份驗證機制（如 JWT、OAuth2）。
    *   **檔案上傳安全**：上傳檔案時必須驗證 MIME Type。
    *   **路徑安全**：避免任意檔案讀寫，防範 File Path Injection。

6.  **資料隱私與合規 (Data Privacy & Compliance)**：
    *   **法規遵循**：系統設計需考量 GDPR、CCPA 等隱私法規要求。
    *   **PII 保護**：個人識別資訊 (PII) 必須加密儲存，並嚴格控管存取權限。
    *   **資料生命週期**：實作資料保存 (Retention) 與刪除策略，過期資料應自動清除或匿名化。
    *   **Cookie 同意**：網站必須實作 Cookie 同意機制，告知使用者追蹤行為。

7.  **專案結構與命名 (Project Structure & Naming)**：
    *   **資料夾結構**：依據功能或職責進行分層（如 `src/components`, `src/services`, `src/utils`），保持結構清晰。
    *   **檔案命名**：
        *   類別/元件檔案：使用 PascalCase (e.g., `UserProfile.tsx`)。
        *   一般函式/工具檔案：使用 camelCase (e.g., `authUtils.ts`) 或 kebab-case (e.g., `auth-utils.ts`)，需全專案統一。
    *   **資源命名**：圖片與資源檔案使用 snake_case 或 kebab-case (e.g., `logo_main.png`)。

8.  **Git 與版本控制 (Git & Version Control)**：
    *   **Commit 訊息**：採用 Conventional Commits 規範 (e.g., `feat: add login`, `fix: resolve crash`, `docs: update readme`)。
    *   **分支策略**：採用 Git Flow 或 GitHub Flow。主分支為 `main` 或 `master`，開發分支為 `develop`，功能分支命名為 `feature/xxx`，修復分支為 `fix/xxx`。
    *   **Pull Request**：所有合併必須透過 Pull Request (PR) 進行，並經過 Code Review。

9.  **DevOps 與部署 (DevOps & Deployment)**：
    *   **CI/CD**：建立自動化 CI/CD 流程，包含建置、測試、部署。
    *   **容器化**：優先使用 Docker 進行容器化，確保環境一致性。
    *   **環境變數**：敏感設定（如 DB 密碼、API Key）必須透過環境變數 (.env) 管理，嚴禁提交至版本控制系統。
    *   **基礎設施即程式碼 (IaC)**：建議使用 Terraform 或 CloudFormation 管理雲端資源。

10. **雲端原生架構 (Cloud Native Architecture)**：
    *   **12-Factor App**：遵循 12-Factor App 原則進行應用程式設計。
    *   **無狀態設計 (Stateless)**：應用程式應設計為無狀態，Session 狀態應儲存於外部快取 (Redis) 或資料庫。
    *   **優雅停機 (Graceful Shutdown)**：應用程式需處理 SIGTERM 信號，完成當前請求後再關閉。
    *   **健康檢查 (Health Check)**：實作 Liveness 與 Readiness Probe endpoint。

11. **可觀測性與監控 (Observability & Monitoring)**：
    *   **指標監控 (Metrics)**：收集關鍵系統指標 (CPU, Memory, Request Rate, Latency)，建議使用 Prometheus 格式。
    *   **分散式追蹤 (Tracing)**：實作分散式追蹤 (OpenTelemetry)，以追蹤跨服務請求。
    *   **結構化日誌 (Logging)**：日誌輸出為 JSON 格式，並包含 Trace ID 以利關聯查詢。
    *   **告警機制 (Alerting)**：針對關鍵錯誤與效能瓶頸設定主動告警。

12. **文件準則 (Documentation Guidelines)**：
    *   **API 文件**：所有 API 必須提供 OpenAPI / Swagger 規格文件。
    *   **README 規範**：README 檔案必須包含系統架構、部署方法、環境設定等必要資訊。
    *   **模組說明**：每個主要模組都必須附帶使用說明文件。
    *   **設計文件控管**：設計規格書 (Design Spec) 必須納入版本控管。
    *   **決策記錄**：重大架構決策必須記錄為 ADR (Architecture Decision Records)。

13. **測試準則 (Testing Guidelines)**：
    *   **單元測試 (Unit Test)**：測試覆蓋率目標應達到 60% 以上。
    *   **API 測試**：所有 API 必須包含自動化測試腳本。
    *   **UI 測試**：建議使用 Cypress 或 Playwright 進行端對端 (E2E) 測試。
    *   **壓力測試 (Load Test)**：系統必須通過壓力測試，並達到可接受的服務水準目標 (SLO)。
    *   **回歸測試 (Regression Test)**：回歸測試必須自動化，以確保新功能不影響既有功能。

14. **國際化與在地化 (i18n & l10n)**：
    *   **字串管理**：嚴禁在程式碼中硬編碼 UI 字串，必須使用資源檔或 i18n 函式庫管理。
    *   **時區處理**：後端資料庫一律儲存 UTC 時間，前端顯示時再轉換為使用者本地時區。
    *   **格式化**：貨幣、日期、數字顯示必須依據使用者語系 (Locale) 進行格式化。

# 領域開發準則 (Domain-Specific Guidelines)

15. **前端開發指南 (Frontend Development Guidelines)**：適用於 Web 與 App 開發。
    *   **通用準則 (General Principles)**：
        *   **元件化設計**：全面採用 Component-based 架構，提高重用性。
        *   **效能標準**：頁面效能需達到 Google Lighthouse A 級標準。
        *   **邏輯分離**：商業邏輯應在後端處理，前端僅負責展示與互動，不可直接處理敏感商業邏輯。
        *   **無障礙設計 (a11y)**：遵循無障礙規範，正確使用 ARIA Label。
        *   **響應式設計 (RWD)**：確保介面在手機、平板、桌機上皆能完美呈現。
        *   **DOM 結構優化**：避免 DOM 巢狀層級過深（建議最大 5–7 層）。
    *   **Web 技術堆疊 (Web Tech Stack)**：
        *   **環境與語言**：HTML5, CSS3, SCSS, JavaScript / Vue.js (CSR/SSG)。
        *   **框架與工具**：Bootstrap 5, BEM/OOCSS, Node.js 20+, Yarn。
        *   **工作流程**：使用 CLI 工具編譯，支援 Vue.js 元件化開發。

16. **後端開發指南 (Backend Development Guidelines)**：適用於 Node.js, Java Spring, Go, Python Flask/FastAPI 等：
    *   **API 標準**：採用 RESTful 或 GraphQL 標準設計 API。
    *   **分層架構**：嚴格遵守分層架構 (Controller / Service / Repository)。
    *   **錯誤處理**：Exception Handling 必須統一，回傳標準化的錯誤格式。
    *   **資料傳輸物件 (DTO)**：禁止直接回傳 DB Model，必須轉換為 DTO (Data Transfer Object)。
    *   **Schema 規範**：Request 與 Response 的 Schema 必須固定且有文件說明。
    *   **日誌規範 (Logging)**：統一使用 INFO, WARN, ERROR 等級記錄日誌，並避免記錄敏感資訊。

17. **API 設計模式 (API Design Patterns)**：
    *   **版本控制 (Versioning)**：API 必須包含版本號 (e.g., `/v1/users`)，以確保向後相容性。
    *   **分頁標準 (Pagination)**：列表類 API 必須支援分頁 (Cursor-based 或 Offset-based)。
    *   **冪等性 (Idempotency)**：POST/PUT/PATCH 操作應支援冪等性，避免重複請求導致資料錯誤。
    *   **流量限制 (Rate Limiting)**：API 需實作 Rate Limiting 機制，防止濫用與攻擊。

18. **資料庫開發準則 (Database Development Guidelines)**：適用於 SQL 與 NoSQL：
    *   **正規化 (Normalization)**：原則上需正規化到 3NF（除非為了效能考量而刻意反正規化）。
    *   **查詢優化**：避免使用 `SELECT *`，僅選取必要的欄位。
    *   **資料型別**：所有欄位必須定義明確且合適的資料型別。
    *   **索引 (Indexing)**：必須建立必要的 Index，避免全表掃描 (Full Table Scan)。
    *   **交易 (Transaction)**：交易操作需嚴格遵守 ACID 原則。
    *   **版本控管 (Migration)**：資料庫架構變更必須使用 Migration 工具進行版本控管。

19. **行動 App 開發準則 (Mobile App Guidelines)**：適用於 Android/iOS (Native, Flutter, React Native)：
    *   **架構模式**：遵循 MVVM 或 Clean Architecture 架構。
    *   **敏感資料儲存**：嚴禁在 App 本地明文儲存敏感資料，必須使用 Keychain (iOS) 或 Keystore (Android)。
    *   **錯誤處理**：所有 API 呼叫都必須包含完整的錯誤處理機制。
    *   **啟動效能**：App 冷啟動時間應控制在 2 秒以內。
    *   **執行緒管理**：嚴禁阻塞主執行緒 (UI Thread)，耗時操作必須在背景執行緒處理。

20. **企業系統開發準則 (Enterprise System Guidelines)**：
    *   **稽核軌跡 (Audit Trail)**：所有資料變動（新增、修改、刪除）都必須記錄詳細日誌。
    *   **權限控管**：必須實施嚴格的 RBAC (Role-Based) 或 ABAC (Attribute-Based) 存取控制。
    *   **可追溯性 (Traceability)**：系統流程必須可追溯，確保每個操作都能追蹤到發起者與時間點。
    *   **資料一致性**：確保資料具有強一致性 (Strong Consistency)，避免分散式系統常見的最終一致性問題影響業務。
    *   **系統介接**：與外部或其他系統介接時，必須透過 API Gateway 進行管理與監控。

21. **嵌入式程式開發準則 (Embedded Systems Guidelines)**：適用於 IoT, MCU, Firmware：
    *   **記憶體管理**：記憶體使用量必須固定，避免動態配置導致碎片化或溢位。
    *   **迴圈控制**：嚴禁使用無限制或阻塞式迴圈，必須搭配 Watchdog 或適當的 Yield 機制。
    *   **故障安全 (Fail-safe)**：硬體錯誤發生時，必須有 Fail-safe 機制確保系統處於安全狀態。
    *   **能源優化**：必須嚴格控制能量消耗，針對電池供電裝置進行最佳化。
    *   **OTA 更新**：Firmware 架構必須支援 OTA (Over-The-Air) 更新機制。

# 程式語言準則 (Language-Specific Guidelines)

22. **Python 開發準則 (Python Development Guidelines)**：
    *   **語法與風格**：
        *   遵循 **PEP 8** 官方風格指南。
        *   使用 **Black** 進行自動排版。
        *   變數命名使用 `snake_case`，類別 (Class) 命名使用 `PascalCase`。
        *   避免過度巢狀的 if/for 結構（建議最多 3 層）。
    *   **程式設計準則**：
        *   優先使用 List Comprehension 取代簡單的 for-loop。
        *   使用 `enumerate()`、`zip()` 取代手動索引操作。
        *   資料處理優先使用標準庫（如 `collections`, `itertools`）。
        *   精確捕獲 Exception，嚴禁使用 `except Exception:` 捕獲所有錯誤。
    *   **架構規範**：
        *   **Flask/FastAPI**：採用分層架構 (Router / Service / Repository)。
        *   **Django**：Model/ORM 需分層處理，避免 Fat Views。
        *   **資料驗證**：強制使用 **Pydantic** 進行資料驗證。

23. **JavaScript / TypeScript 開發準則 (JS/TS Development Guidelines)**：
    *   **語法與風格**：
        *   變數與函式使用 `camelCase`，類別 (Class) 使用 `PascalCase`。
        *   比較運算子一律使用 `===` (Strict Equality)，禁止使用 `==`。
        *   變數宣告優先使用 `const`，其次 `let`，嚴禁使用 `var`。
        *   縮排嚴格禁止混用 Tab 與 Space。
    *   **程式設計準則**：
        *   **函式長度**：保持函式輕量，建議不超過 30 行。
        *   **非同步處理**：全面使用 `async/await`，避免 Callback Hell。
        *   **物件存取**：避免深層物件直接存取，應使用 Optional Chaining (`?.`)。
    *   **前端開發 (React / Vue)**：
        *   **元件化**：遵循元件化原則，單一元件檔案不應超過 300 行。
        *   **邏輯分離**：UI 元件不應包含大量業務邏輯，應抽離至 Hooks 或 Service。
        *   **React 優化**：善用 `useCallback` 避免 render 時重複建立函式。
        *   **Vue 優化**：避免過度使用 Watchers，優先使用 Computed Properties。
    *   **Node.js 後端**：
        *   **分層架構**：Express/NestJS 需採用 Controller / Service / Repository 分層。
        *   **錯誤處理**：所有 API 實作需以 `async/await` 搭配 `try/catch` 進行錯誤捕獲。
        *   **檔案系統**：禁止使用 Callback-based FS API，應使用 `fs/promises`。

24. **Java 開發準則 (Java Development Guidelines)**：適用於 Spring Boot：
    *   **語法與風格**：
        *   類別 (Class) 使用 `PascalCase`，常數使用 `UPPER_CASE`。
        *   方法命名以動詞開頭 (e.g., `getUser`, `updateOrder`)。
        *   每個檔案僅包含一個 `public class`。
    *   **程式設計準則**：
        *   遵循 OOP 與 SOLID 原則。
        *   服務層 (Service Layer) 應使用 `interface` 定義。
        *   避免過度使用 `static` 方法，以免破壞依賴注入與測試。
        *   字串處理優先使用 `StringBuilder` 或 `String.format`。
    *   **Spring Boot 規範**：
        *   **分層職責**：Controller 僅處理請求與回應，業務邏輯必須交由 Service 處理。
        *   **資料存取**：Service 禁止直接存取資料庫，必須透過 Repository 層。
        *   **資料傳輸**：必須使用 DTO (Data Transfer Object)，嚴禁直接暴露 Entity。
        *   **交易控制**：使用 `@Transactional` 註解管理交易邊界。
        *   **依賴注入**：禁止使用 `@Autowired` 進行 Field Injection，必須使用 Constructor Injection。

25. **Go (Golang) 開發準則 (Go Development Guidelines)**：
    *   **語法與風格**：
        *   **簡潔性**：不寫多餘的括號，遵循 Go 的簡潔風格。
        *   **命名**：變數命名簡短但清楚 (e.g., `i`, `ctx`, `req`)。
        *   **格式化**：強制使用 `gofmt` 進行格式化。
        *   **套件命名**：Package 名稱全小寫，不可包含底線。
    *   **程式設計準則**：
        *   **錯誤處理**：錯誤必須回傳處理，嚴禁忽略錯誤 (`if err != nil {}`)。
        *   **設計哲學**：遵循 Go 的簡單哲學，避免過度設計複雜的 OOP 結構。
        *   **介面設計**：Interface 應盡量小且精確（只定義需要的）。
        *   **依賴管理**：嚴禁 Package 之間的循環依賴。
    *   **併發處理 (Concurrency)**：
        *   **Goroutine 管理**：每個 Goroutine 都必須具備取消機制 (Context)。
        *   **Channel 使用**：Channel 不可存無限資料，需適當使用 Buffer。
        *   **Race Condition**：必須避免 Race Condition，並使用 `go vet` 進行檢查。
    *   **專案架構**：
        *   **目錄結構**：採用標準 Layout (`cmd`, `pkg`, `internal`)。
        *   **設定管理**：關鍵設定使用 `.env` 搭配 Viper 進行管理。

26. **C# (.NET) 開發準則 (C#/.NET Development Guidelines)**：
    *   **語法與風格**：
        *   **命名慣例**：Class, Method, Property 使用 `PascalCase`；變數與參數使用 `camelCase`。
        *   **禁止事項**：嚴禁使用 `snake_case`（常數除外）。
    *   **程式設計準則**：
        *   **非同步處理**：全面使用 `async/await` 進行非同步操作。
        *   **鎖定機制**：避免使用大量同步鎖 (`lock`)，以免造成效能瓶頸。
        *   **集合處理**：優先使用 LINQ 取代手動迴圈處理集合。
        *   **邏輯分離**：避免 Fat Model，業務邏輯應置於 Service 層。
    *   **ASP.NET Core Web API**：
        *   **分層架構**：採用 Controller → Service → Repository 分層架構。
        *   **依賴注入**：必須使用 Dependency Injection (DI) 管理相依性。
        *   **資料傳輸**：使用 DTO 模型，嚴禁直接暴露 EF Entity。
        *   **物件映射**：建議使用 AutoMapper 進行物件轉換。
    *   **Entity Framework Core**：
        *   **查詢優化**：注意 N+1 Query 問題，善用 `.Include()` 載入關聯資料。
        *   **遷移管理**：Migration 必須納入版本控管。
        *   **SQL 使用**：除非必要，避免在程式碼中手寫 SQL。
        *   **非同步查詢**：資料庫查詢必須使用非同步方法 (e.g., `ToListAsync()`)。
